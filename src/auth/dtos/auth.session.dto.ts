import { Staff } from '@prisma/client';

/**
 * DTO (Data Transfer Object) для представления сессии аутентификации пользователя.
 *
 * Описывает структуру данных, хранящих текущее состояние процесса аутентификации
 * в диалоге с ботом, включая:
 * - текущий этап процесса;
 * - введённые пользователем данные (телефон, ФИО);
 * - сгенерированный код подтверждения;
 * - найденную информацию о сотруднике;
 * - служебные поля (время создания, счётчик попыток, ID таймера).
 *
 * @class AuthSessionDto
 */
export class AuthSessionDto {
    /**
   * Текущий этап процесса аутентификации.
   *
   * Возможные значения:
   * - `'awaiting_phone'` — ожидание ввода номера телефона;
   * - `'awaiting_fullname'` — ожидание ввода полного имени (ФИО);
   * - `'awaiting_code'` — ожидание ввода кода подтверждения.
   *
   * @type {'awaiting_phone' | 'awaiting_fullname' | 'awaiting_code'}
   */
  step: 'awaiting_phone' | 'awaiting_fullname' | 'awaiting_code';
  
  /**
   * Введённый пользователем номер телефона (в формате '+79991234567') или null,
   * если номер ещё не указан.
   *
   * @type {string | null}
   */
  phone: string | null;
  
  /**
   * Введённое пользователем полное имя (ФИО) или null, если ФИО ещё не указано.
   *
   * @type {string | null}
   */
  fullname: string | null;
  
    /**
   * Сгенерированный код подтверждения (4‑значное число) или undefined,
   * если код ещё не создан.
   *
   * @type {number | undefined}
   */
  code: number | undefined;
  
    /**
   * Список сотрудников, найденных по введённому номеру телефона, или null,
   * если поиск ещё не выполнялся или не дал результатов.
   *
   * @type {Staff[] | null}
   */
  possibleStaff: Staff[] | null;
  
    /**
   * Конкретный сотрудник, сопоставленный с пользователем (после ввода ФИО или при однозначном
   * совпадении по телефону), или null, если сопоставление не выполнено.
   *
   * @type {Staff | null}
   */
  matchedStaff: Staff | null;
  
    /**
   * Дата и время создания сессии аутентификации.
   *
   * Используется для расчёта времени жизни сессии и определения устаревших записей.
   *
   * @type {Date}
   */
  createdAt: Date;
  
    /**
   * Количество попыток ввода кода подтверждения (по умолчанию 0).
   *
   * Позволяет ограничить число попыток ввода неверного кода (например, до 10).
   * Поле опциональное — если не указано, считается равным 0.
   *
   * @type {number | undefined}
   * @default 0
   */
  attemptsCount?: number;
  
  /**
   * Идентификатор таймера (timeout), установленного для автоудаления сессии по истечении времени.
   *
   * Может быть:
   * - `undefined` — если таймер не установлен;
   * - экземпляром `NodeJS.Timeout` — если таймер активен.
   *
   * Используется сервисом SessionManagerService для управления временем жизни сессии.
   *
   * @type {NodeJS.Timeout | undefined}
   */
  timeoutId?: NodeJS.Timeout; // может быть undefined или ID таймера
}
